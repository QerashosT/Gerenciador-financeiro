{% extends "auth_base.html" %}

{% block content %}

    <div class="auth-header">
        <img src="{{ url_for('static', filename='images/Me_ajuda_ai_logo.svg') }}" alt="Logo Me Ajuda AI" class="auth-logo">
        <h1 class="auth-title">Me Ajuda <span>AI</span></h1>
    </div>

    <form method="POST" action="" class="auth-form" novalidate>
        {{ form.hidden_tag() }}

        <h2>Cadastro</h2>

        <div class="form-group">
            {{ form.name.label(text="Nome*") }}
            {{ form.name(placeholder="João Arnaldo") }}
            {% if form.name.errors %}
                <div class="errors">
                    {% for error in form.name.errors %}<span>{{ error }}</span>{% endfor %}
                </div>
            {% endif %}
        </div>

        <div class="form-group">
            {{ form.email.label(text="E-mail*") }}
            {{ form.email(placeholder="arnoldjunior@gmail.com") }}
            {% if form.email.errors %}
                <div class="errors">
                    {% for error in form.email.errors %}<span>{{ error }}</span>{% endfor %}
                </div>
            {% endif %}
        </div>

        <div class="form-group">
            {{ form.password.label(text="Senha*") }}
            {{ form.password(placeholder="ex: 123!@#321") }}
            {% if form.password.errors %}
                <div class="errors">
                    {% for error in form.password.errors %}<span>{{ error }}</span>{% endfor %}
                </div>
            {% endif %}
        </div>

        <div class="form-group">
            {{ form.confirm_password.label(text="Confirmar Senha*") }}
            {{ form.confirm_password(placeholder="Repita sua senha") }}
            {% if form.confirm_password.errors %}
                <div class="errors">
                    {% for error in form.confirm_password.errors %}<span>{{ error }}</span>{% endfor %}
                </div>
            {% endif %}
        </div>

        <div class="form-group">
            {{ form.submit(class="btn-primary", value="Criar") }}
        </div>
    </form>

    <div class="auth-link">
        Já tem conta? <a href="{{ url_for('auth.login') }}">Entre</a>
    </div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const passwordInput = document.querySelector('input[name="password"]');

        if (!passwordInput) return;

        // Criar indicador de força
        const strengthIndicator = document.createElement('div');
        strengthIndicator.className = 'password-strength';
        strengthIndicator.innerHTML = `
            <div class="strength-bar">
                <div class="strength-bar-fill"></div>
            </div>
            <p class="strength-text">Digite uma senha</p>
        `;

        // Inserir após o wrapper da senha (dentro do form-group)
        // Usamos closest('.form-group') para garantir que pegamos o container correto
        const formGroup = passwordInput.closest('.form-group');
        if (formGroup) {
            formGroup.appendChild(strengthIndicator);
        } else {
            // Fallback caso a estrutura mude
            passwordInput.parentElement.appendChild(strengthIndicator);
        }

        // Função para calcular força da senha
        function checkPasswordStrength(password) {
            let strength = 0;
            const feedback = [];

            // Critérios
            if (password.length >= 8) {
                strength += 20;
            } else {
                feedback.push('Mínimo 8 caracteres');
            }

            if (password.length >= 12) strength += 10;

            if (/[a-z]/.test(password)) {
                strength += 20;
            } else {
                feedback.push('Adicione letras minúsculas');
            }

            if (/[A-Z]/.test(password)) {
                strength += 20;
            } else {
                feedback.push('Adicione letras MAIÚSCULAS');
            }

            if (/\d/.test(password)) {
                strength += 20;
            } else {
                feedback.push('Adicione números');
            }

            if (/[!@#$%^&*(),.?":{}|<>]/.test(password)) {
                strength += 20;
            } else {
                feedback.push('Adicione caracteres especiais (!@#$%)');
            }

            // Senhas comuns
            const commonPasswords = ['password', '123456', 'qwerty', 'senha'];
            if (commonPasswords.some(common => password.toLowerCase().includes(common))) {
                strength = Math.min(strength, 40);
                feedback.unshift('⚠️ Senha muito comum');
            }

            return { strength, feedback };
        }

        // Atualizar indicador
        passwordInput.addEventListener('input', function() {
            const password = this.value;
            const { strength, feedback } = checkPasswordStrength(password);

            const fill = strengthIndicator.querySelector('.strength-bar-fill');
            const text = strengthIndicator.querySelector('.strength-text');

            // Atualizar barra
            fill.style.width = strength + '%';

            // Atualizar cor e texto
            if (strength < 40) {
                fill.style.backgroundColor = '#FF4757';
                text.textContent = 'Fraca';
                text.style.color = '#FF4757';
            } else if (strength < 70) {
                fill.style.backgroundColor = '#FFD302';
                text.textContent = 'Média';
                text.style.color = '#B88400';
            } else {
                fill.style.backgroundColor = '#35D16C';
                text.textContent = 'Forte';
                text.style.color = '#0B4338';
            }

            // Mostrar dicas
            if (feedback.length > 0 && password.length > 0) {
                text.textContent += ': ' + feedback.join(', ');
            }
        });
    });
</script>
{% endblock %}