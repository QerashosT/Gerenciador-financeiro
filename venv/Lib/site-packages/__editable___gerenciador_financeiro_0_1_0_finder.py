from __future__ import annotations
import sys
from importlib.machinery import ModuleSpec, PathFinder
from importlib.machinery import all_suffixes as module_suffixes
from importlib.util import spec_from_file_location
from itertools import chain
from pathlib import Path

MAPPING: dict[str, str] = {'rust_structures': 'C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures'}
NAMESPACES: dict[str, list[str]] = {'rust_structures.src': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\src'], 'rust_structures.target': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target'], 'rust_structures.target.debug': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug'], 'rust_structures.target.debug.build': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build'], 'rust_structures.target.debug.deps': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\deps'], 'rust_structures.target.debug.examples': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\examples'], 'rust_structures.target.debug.incremental': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\incremental'], 'rust_structures.target.debug.build.libc-3e133949ef7a6dfe': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\libc-3e133949ef7a6dfe'], 'rust_structures.target.debug.build.libc-502bf233a6cd5126': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\libc-502bf233a6cd5126'], 'rust_structures.target.debug.build.memoffset-35fab1637d274f2f': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\memoffset-35fab1637d274f2f'], 'rust_structures.target.debug.build.memoffset-96efca7ff39052b4': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\memoffset-96efca7ff39052b4'], 'rust_structures.target.debug.build.parking_lot_core-0f9575b8cb61f8af': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\parking_lot_core-0f9575b8cb61f8af'], 'rust_structures.target.debug.build.parking_lot_core-ae7b9910c0c80335': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\parking_lot_core-ae7b9910c0c80335'], 'rust_structures.target.debug.build.proc-macro2-5c21a10974bec8c5': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\proc-macro2-5c21a10974bec8c5'], 'rust_structures.target.debug.build.proc-macro2-697d1996947c22a1': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\proc-macro2-697d1996947c22a1'], 'rust_structures.target.debug.build.pyo3-21abf069ff053525': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\pyo3-21abf069ff053525'], 'rust_structures.target.debug.build.pyo3-474e1f19d7a7309b': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\pyo3-474e1f19d7a7309b'], 'rust_structures.target.debug.build.pyo3-build-config-43df070829b16a52': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\pyo3-build-config-43df070829b16a52'], 'rust_structures.target.debug.build.pyo3-build-config-48dac3ea84fde6a2': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\pyo3-build-config-48dac3ea84fde6a2'], 'rust_structures.target.debug.build.pyo3-ffi-6bfbbc467f8bb20a': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\pyo3-ffi-6bfbbc467f8bb20a'], 'rust_structures.target.debug.build.pyo3-ffi-ed131caeda8d0acc': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\pyo3-ffi-ed131caeda8d0acc'], 'rust_structures.target.debug.build.quote-1e95813ad118ecd5': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\quote-1e95813ad118ecd5'], 'rust_structures.target.debug.build.quote-e35e11d17b7b902e': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\quote-e35e11d17b7b902e'], 'rust_structures.target.debug.build.syn-3a376f9b0817bbe0': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\syn-3a376f9b0817bbe0'], 'rust_structures.target.debug.build.syn-ad985633399da74c': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\syn-ad985633399da74c'], 'rust_structures.target.debug.build.target-lexicon-22f1b781392e0f98': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\target-lexicon-22f1b781392e0f98'], 'rust_structures.target.debug.build.target-lexicon-7ec19c27bfec891c': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\target-lexicon-7ec19c27bfec891c'], 'rust_structures.target.debug.build.libc-3e133949ef7a6dfe.out': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\libc-3e133949ef7a6dfe\\out'], 'rust_structures.target.debug.build.memoffset-35fab1637d274f2f.out': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\memoffset-35fab1637d274f2f\\out'], 'rust_structures.target.debug.build.parking_lot_core-ae7b9910c0c80335.out': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\parking_lot_core-ae7b9910c0c80335\\out'], 'rust_structures.target.debug.build.proc-macro2-697d1996947c22a1.out': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\proc-macro2-697d1996947c22a1\\out'], 'rust_structures.target.debug.build.pyo3-21abf069ff053525.out': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\pyo3-21abf069ff053525\\out'], 'rust_structures.target.debug.build.pyo3-build-config-43df070829b16a52.out': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\pyo3-build-config-43df070829b16a52\\out'], 'rust_structures.target.debug.build.pyo3-ffi-ed131caeda8d0acc.out': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\pyo3-ffi-ed131caeda8d0acc\\out'], 'rust_structures.target.debug.build.quote-1e95813ad118ecd5.out': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\quote-1e95813ad118ecd5\\out'], 'rust_structures.target.debug.build.syn-ad985633399da74c.out': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\syn-ad985633399da74c\\out'], 'rust_structures.target.debug.build.target-lexicon-22f1b781392e0f98.out': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\build\\target-lexicon-22f1b781392e0f98\\out'], 'rust_structures.target.debug.incremental.rust_structures-2kyctrlme6fp6': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\incremental\\rust_structures-2kyctrlme6fp6'], 'rust_structures.target.debug.incremental.rust_structures-2rtvxigxf6lsf': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\incremental\\rust_structures-2rtvxigxf6lsf'], 'rust_structures.target.debug.incremental.rust_structures-35eoyhl1irzrr': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\incremental\\rust_structures-35eoyhl1irzrr'], 'rust_structures.target.debug.incremental.rust_structures-39m4ja9iir84z': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\incremental\\rust_structures-39m4ja9iir84z'], 'rust_structures.target.debug.incremental.rust_structures-3w0242hla92y4': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\incremental\\rust_structures-3w0242hla92y4'], 'rust_structures.target.debug.incremental.rust_structures-2kyctrlme6fp6.s-hchvkr84eh-08y7y76-0uc2nahjppejquf4hewot0utk': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\incremental\\rust_structures-2kyctrlme6fp6\\s-hchvkr84eh-08y7y76-0uc2nahjppejquf4hewot0utk'], 'rust_structures.target.debug.incremental.rust_structures-2rtvxigxf6lsf.s-hchv7sxr4k-1s70ica-16schiqaa7fjzxw36icr6brhf': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\incremental\\rust_structures-2rtvxigxf6lsf\\s-hchv7sxr4k-1s70ica-16schiqaa7fjzxw36icr6brhf'], 'rust_structures.target.debug.incremental.rust_structures-35eoyhl1irzrr.s-hchvkr8atp-09e9ai0-e1g2wkeddem5pyramdmkd5ruk': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\incremental\\rust_structures-35eoyhl1irzrr\\s-hchvkr8atp-09e9ai0-e1g2wkeddem5pyramdmkd5ruk'], 'rust_structures.target.debug.incremental.rust_structures-39m4ja9iir84z.s-hchv7sxnbm-051mshe-cmc8vsswtg8q877gdayi3soql': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\incremental\\rust_structures-39m4ja9iir84z\\s-hchv7sxnbm-051mshe-cmc8vsswtg8q877gdayi3soql'], 'rust_structures.target.debug.incremental.rust_structures-3w0242hla92y4.s-hchvpa6pvi-0986s2w-ag4o2y3gpry9lqing25fp6prw': ['C:\\Users\\jvnso\\Programacao\\Cursos\\ProjetosAulaFecaf\\Gerenciador-financeiro\\rust_structures\\target\\debug\\incremental\\rust_structures-3w0242hla92y4\\s-hchvpa6pvi-0986s2w-ag4o2y3gpry9lqing25fp6prw']}
PATH_PLACEHOLDER = '__editable__.gerenciador_financeiro-0.1.0.finder' + ".__path_hook__"


class _EditableFinder:  # MetaPathFinder
    @classmethod
    def find_spec(cls, fullname: str, path=None, target=None) -> ModuleSpec | None:  # type: ignore
        # Top-level packages and modules (we know these exist in the FS)
        if fullname in MAPPING:
            pkg_path = MAPPING[fullname]
            return cls._find_spec(fullname, Path(pkg_path))

        # Handle immediate children modules (required for namespaces to work)
        # To avoid problems with case sensitivity in the file system we delegate
        # to the importlib.machinery implementation.
        parent, _, child = fullname.rpartition(".")
        if parent and parent in MAPPING:
            return PathFinder.find_spec(fullname, path=[MAPPING[parent]])

        # Other levels of nesting should be handled automatically by importlib
        # using the parent path.
        return None

    @classmethod
    def _find_spec(cls, fullname: str, candidate_path: Path) -> ModuleSpec | None:
        init = candidate_path / "__init__.py"
        candidates = (candidate_path.with_suffix(x) for x in module_suffixes())
        for candidate in chain([init], candidates):
            if candidate.exists():
                return spec_from_file_location(fullname, candidate)
        return None


class _EditableNamespaceFinder:  # PathEntryFinder
    @classmethod
    def _path_hook(cls, path) -> type[_EditableNamespaceFinder]:
        if path == PATH_PLACEHOLDER:
            return cls
        raise ImportError

    @classmethod
    def _paths(cls, fullname: str) -> list[str]:
        paths = NAMESPACES[fullname]
        if not paths and fullname in MAPPING:
            paths = [MAPPING[fullname]]
        # Always add placeholder, for 2 reasons:
        # 1. __path__ cannot be empty for the spec to be considered namespace.
        # 2. In the case of nested namespaces, we need to force
        #    import machinery to query _EditableNamespaceFinder again.
        return [*paths, PATH_PLACEHOLDER]

    @classmethod
    def find_spec(cls, fullname: str, target=None) -> ModuleSpec | None:  # type: ignore
        if fullname in NAMESPACES:
            spec = ModuleSpec(fullname, None, is_package=True)
            spec.submodule_search_locations = cls._paths(fullname)
            return spec
        return None

    @classmethod
    def find_module(cls, _fullname) -> None:
        return None


def install():
    if not any(finder == _EditableFinder for finder in sys.meta_path):
        sys.meta_path.append(_EditableFinder)

    if not NAMESPACES:
        return

    if not any(hook == _EditableNamespaceFinder._path_hook for hook in sys.path_hooks):
        # PathEntryFinder is needed to create NamespaceSpec without private APIS
        sys.path_hooks.append(_EditableNamespaceFinder._path_hook)
    if PATH_PLACEHOLDER not in sys.path:
        sys.path.append(PATH_PLACEHOLDER)  # Used just to trigger the path hook
